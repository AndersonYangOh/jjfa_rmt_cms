var $api=new apiUtils.Api(apiUrl+"/pages/cms/contents"),$createApi=new apiUtils.Api(apiUrl+"/pages/cms/contents/actions/create");Object.defineProperty(Object.prototype,"getProp",{value:function(t){var e;for(e in this)if(e.toLowerCase()==t.toLowerCase())return this[e]}});var data={siteId:parseInt(pageUtils.getQueryStringByName("siteId")),channelId:parseInt(pageUtils.getQueryStringByName("channelId")),pageLoad:!1,pageAlert:null,pageType:null,page:1,pageContents:null,count:null,pages:null,permissions:null,columns:null,pageOptions:null,isAllChecked:!1},methods={btnAddClick:function(t){t.stopPropagation(),location.href="pageContentAdd.aspx?siteId="+this.siteId+"&channelId="+this.channelId},btnCreateClick:function(t){t.stopPropagation();var e=this;e.pageAlert=null,0!==e.selectedContentIds.length&&(pageUtils.loading(!0),$createApi.post({siteId:e.siteId,channelId:e.channelId,contentIds:e.selectedContentIds.join(",")},function(t,n){!t&&n&&n.value&&(pageUtils.loading(!1),e.pageAlert={type:"success",html:"内容已添加至生成列队！<a href='createStatus.cshtml?siteId="+e.siteId+"'>生成进度查看</a>"})}))},btnLayerClick:function(t,e){e.stopPropagation(),this.pageAlert=null;var n="contentsLayer"+t.name+".cshtml?siteId="+this.siteId+"&channelId="+this.channelId;if(t.withContents){if(0===this.selectedContentIds.length)return;n+="&contentIds="+this.selectedContentIds.join(",")}else t.withOptionalContents?this.selectedContentIds.length>0&&(n+="&contentIds="+this.selectedContentIds.join(",")):t.contentId&&(n+="&contentId="+t.contentId);n+="&returnUrl="+encodeURIComponent(location.href),pageUtils.openLayer({title:t.title,url:n,full:t.full,width:t.width?t.width:700,height:t.height?t.height:500})},btnContentViewClick:function(t,e){e.stopPropagation(),pageUtils.openLayer({title:"查看内容",url:"contentsLayerView.cshtml?siteId="+this.siteId+"&channelId="+this.channelId+"&contentId="+t,full:!0})},btnContentStateClick:function(t,e){e.stopPropagation(),pageUtils.openLayer({title:"查看审核状态",url:"contentsLayerState.cshtml?siteId="+this.siteId+"&channelId="+this.channelId+"&contentId="+t,full:!0})},toggleChecked:function(t){t.isSelected=!t.isSelected,t.isSelected||(this.isAllChecked=!1)},selectAll:function(){this.isAllChecked=!this.isAllChecked;for(var t=0;t<this.pageContents.length;t++)this.pageContents[t].isSelected=this.isAllChecked},loadFirstPage:function(){1!==this.page&&this.loadContents(1)},loadPrevPage:function(){this.page-1<=0||this.loadContents(this.page-1)},loadNextPage:function(){this.page+1>this.pages||this.loadContents(this.page+1)},loadLastPage:function(){this.page+1>this.pages||this.loadContents(this.pages)},onPageSelect:function(t){this.loadContents(t)},scrollToTop:function(){document.documentElement.scrollTop=document.body.scrollTop=0},getPluginMenuUrl:function(t){return t.href+"&returnUrl="+encodeURIComponent(location.href)},btnPluginMenuClick:function(t,e){e.stopPropagation(),"_layer"===t.target&&pageUtils.openLayer({title:t.text,url:this.getPluginMenuUrl(t),full:!0})},loadContents:function(t){var e=this;e.pageLoad&&pageUtils.loading(!0),$api.get({siteId:e.siteId,channelId:e.channelId,page:t},function(n,s){if(!n&&s&&s.value){for(var i=[],o=0;o<s.value.length;o++){var l=_.assign({},s.value[o],{isSelected:!1});i.push(l)}e.pageContents=i,e.count=s.count,e.pages=s.pages,e.permissions=s.permissions,e.columns=s.columns,e.page=t,e.pageOptions=[];for(o=1;o<=e.pages;o++)e.pageOptions.push(o);e.pageLoad?(pageUtils.loading(!1),e.scrollToTop()):e.pageLoad=!0}})}};Vue.component("multiselect",window.VueMultiselect.default);var $vue=new Vue({el:"#main",data:data,methods:methods,computed:{selectedContentIds:function(){var t=[];if(this.pageContents)for(var e=0;e<this.pageContents.length;e++)this.pageContents[e].isSelected&&t.push(this.pageContents[e].id);return t}},created:function(){this.loadContents(1)}});